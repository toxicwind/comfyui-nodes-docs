# Documentation
- Class name: TripoSRSampler
- Category: Flowty TripoSR
- Output node: False
- Repo Ref: https://github.com/flowtyone/ComfyUI-Flowty-TripoSR

The TripoSRSampler class facilitates the process of generating 3D grids from 2D images by using the ability of in-depth learning models to interpret scene codes and extract geometric details. It transforms visual data into structured expressions that make possible applications in various fields, such as computer visual and graphic rendering.

# Input types
## Required
- model
    - Model parameters are essential for TripoSRSampler, which contains a well-trained neural network that converts 2D images to a 3D grid. It is the backbone of the process and determines the quality and accuracy of the final output.
    - Comfy dtype: TRIPOSR_MODEL
    - Python dtype: torch.nn.Module
- reference_image
    - The reference image is the main input into the 3D grid generation process. For a model, it is essential to explain and extract the geometric information necessary to accurately indicate the creation of the scene.
    - Comfy dtype: IMAGE
    - Python dtype: PIL.Image.Image
- geometry_resolution
    - Geometric resolution is a key parameter that affects the level of detail generated by the 3D grid. Higher resolution produces more complex and fine particle output, which is essential for high-precision applications.
    - Comfy dtype: INT
    - Python dtype: int
- threshold
    - The threshold parameter plays an important role in determining the contrast and clarity of the extracted 3D structure. It influences how the model is present to distinguish between the different elements and influences the final visual result.
    - Comfy dtype: FLOAT
    - Python dtype: float
## Optional
- reference_mask
    - When provided, the reference mask helps improve the 3D grid generation by specifying the interest areas in the image. It helps the model focus on the relevant parts of the scene and improves the accuracy of the output.
    - Comfy dtype: MASK
    - Python dtype: torch.Tensor

# Output types
- mesh
    - The output grid is the tangible result of the 3D sampling process, representing the transformation of the input image into geometric structures. It is a key component for further analysis, visualization and application in each collar.
    - Comfy dtype: MESH
    - Python dtype: trimesh.Trimesh

# Usage tips
- Infra type: GPU

# Source code
```
class TripoSRSampler:

    def __init__(self):
        self.initialized_model = None

    @classmethod
    def INPUT_TYPES(s):
        return {'required': {'model': ('TRIPOSR_MODEL',), 'reference_image': ('IMAGE',), 'geometry_resolution': ('INT', {'default': 256, 'min': 128, 'max': 12288}), 'threshold': ('FLOAT', {'default': 25.0, 'min': 0.0, 'step': 0.01})}, 'optional': {'reference_mask': ('MASK',)}}
    RETURN_TYPES = ('MESH',)
    FUNCTION = 'sample'
    CATEGORY = 'Flowty TripoSR'

    def sample(self, model, reference_image, geometry_resolution, threshold, reference_mask=None):
        device = get_torch_device()
        if not torch.cuda.is_available():
            device = 'cpu'
        image = reference_image[0]
        if reference_mask is not None:
            mask = reference_mask[0].unsqueeze(2)
            image = torch.cat((image, mask), dim=2).detach().cpu().numpy()
        else:
            image = image.detach().cpu().numpy()
        image = Image.fromarray(np.clip(255.0 * image, 0, 255).astype(np.uint8))
        if reference_mask is not None:
            image = fill_background(image)
        image = image.convert('RGB')
        scene_codes = model([image], device)
        meshes = model.extract_mesh(scene_codes, resolution=geometry_resolution, threshold=threshold)
        return ([meshes[0]],)
```