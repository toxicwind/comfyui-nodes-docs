# Apply AnimateDiff+CameraCtrl Model üé≠üÖêüÖì‚ë°
## Documentation
- Class name: ADE_ApplyAnimateDiffModelWithCameraCtrl
- Category: Animate Diff üé≠üÖêüÖì/‚ë° Gen2 nodes ‚ë°/CameraCtrl
- Output node: False
- Repo Ref: https://github.com/Kosinkadink/ComfyUI-AnimateDiff-Evolved.git

This node combines the Animat√©Diff model with camera control, integrating motion model adjustments and camera control parameters to generate animated sequences. It uses the camera to control positions and other animated parameters to enhance the output of the Animat√©Diff model and to provide a more dynamic and customized animation experience.

## Input types
### Required
- motion_model
    - The motion models to be animated are combined with the function of the AnimateDiff model and camera control features to enhance the animation.
    - Comfy dtype: MOTION_MODEL_ADE
    - Python dtype: MotionModelPatcher
- cameractrl_poses
    - The camera controls a list of positions, each of which defines the location and direction of a particular camera during the animation process.
    - Comfy dtype: CAMERACTRL_POSES
    - Python dtype: list[list[float]]
- start_percent
    - The starting percentage of animation, as part of the total animation length, allows for partial animation.
    - Comfy dtype: FLOAT
    - Python dtype: float
- end_percent
    - The percentage ending the animation as part of the total animation length is allowed to define the duration of the animation.
    - Comfy dtype: FLOAT
    - Python dtype: float

### Optional
- motion_lora
    - Optional parameters to specify a motion LoRA setting to further customize animations.
    - Comfy dtype: MOTION_LORA
    - Python dtype: MotionLoraList
- scale_multival
    - Optional parameters are used to apply scale multipliers to influence the overall size of animated elements.
    - Comfy dtype: MULTIVAL
    - Python dtype: dict
- effect_multival
    - Optional parameters are used to apply effect multipliers to allow other visual effects to be added to animated drawings.
    - Comfy dtype: MULTIVAL
    - Python dtype: dict
- cameractrl_multival
    - Optional parameters are used to apply multiple camera control values to enhance dynamic camera motion in animations.
    - Comfy dtype: MULTIVAL
    - Python dtype: dict
- ad_keyframes
    - Optional parameters are used to define key frames in animations and allow precise control of animated sequences.
    - Comfy dtype: AD_KEYFRAMES
    - Python dtype: ADKeyframeGroup
- prev_m_models
    - Optional parameters are used to integrate previously generated motion models and promote sequence or layered animations.
    - Comfy dtype: M_MODELS
    - Python dtype: MotionModelGroup

## Output types
- m_models
    - Comfy dtype: M_MODELS
    - Motion models, including any specified animations and effects, generated by the application of the Animat√©Diff model and camera control.
    - Python dtype: MotionModelGroup

## Usage tips
- Infra type: GPU
- Common nodes: unknown

## Source code
```python
class ApplyAnimateDiffWithCameraCtrl:
    @classmethod
    def INPUT_TYPES(s):
        return {
            "required": {
                "motion_model": ("MOTION_MODEL_ADE",),
                "cameractrl_poses": ("CAMERACTRL_POSES",),
                "start_percent": ("FLOAT", {"default": 0.0, "min": 0.0, "max": 1.0, "step": 0.001}),
                "end_percent": ("FLOAT", {"default": 1.0, "min": 0.0, "max": 1.0, "step": 0.001}),
            },
            "optional": {
                "motion_lora": ("MOTION_LORA",),
                "scale_multival": ("MULTIVAL",),
                "effect_multival": ("MULTIVAL",),
                "cameractrl_multival": ("MULTIVAL",),
                "ad_keyframes": ("AD_KEYFRAMES",),
                "prev_m_models": ("M_MODELS",),
            }
        }
    
    RETURN_TYPES = ("M_MODELS",)
    CATEGORY = "Animate Diff üé≠üÖêüÖì/‚ë° Gen2 nodes ‚ë°/CameraCtrl"
    FUNCTION = "apply_motion_model"

    def apply_motion_model(self, motion_model: MotionModelPatcher, cameractrl_poses: list[list[float]], start_percent: float=0.0, end_percent: float=1.0,
                           motion_lora: MotionLoraList=None, ad_keyframes: ADKeyframeGroup=None,
                           scale_multival=None, effect_multival=None, cameractrl_multival=None,
                           prev_m_models: MotionModelGroup=None,):
        new_m_models = ApplyAnimateDiffModelNode.apply_motion_model(self, motion_model, start_percent=start_percent, end_percent=end_percent,
                                                                    motion_lora=motion_lora, ad_keyframes=ad_keyframes,
                                                                    scale_multival=scale_multival, effect_multival=effect_multival, prev_m_models=prev_m_models)
        # most recent added model will always be first in list;
        curr_model = new_m_models[0].models[0]
        # confirm that model contains camera_encoder
        if curr_model.model.camera_encoder is None:
            raise Exception(f"Motion model '{curr_model.model.mm_info.mm_name}' does not contain a camera_encoder; cannot be used with Apply AnimateDiff-CameraCtrl Model node.")
        camera_entries = [CameraEntry(entry) for entry in cameractrl_poses]
        curr_model.orig_camera_entries = camera_entries
        curr_model.cameractrl_multival = cameractrl_multival
        return new_m_models