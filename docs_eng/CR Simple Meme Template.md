# Documentation
- Class name: CR_SimpleMemeTemplate
- Category: Comfyroll/Graphics/Template
- Output node: False
- Repo Ref: https://github.com/RockOfFire/ComfyUI_Comfyroll_CustomNodes

CR_SimpleMememTemplate is a node used to generate a custom molding template. It allows users to enter a picture, select a default for the molding structure, and add text to the top and bottom of the picture. The node also provides custom options for fonts, text colours, and the addition of decorative bars above and below the text. The node is primarily designed to facilitate the creation of the molding image using a simple user interface that is easy to use by a broad user community for moldinging.

# Input types
## Required
- image
    - The image parameter is necessary because it defines the basic picture that will be applied to the molding template. The selection of the image directly affects the final appearance of the mold, making it a key element in node operations.
    - Comfy dtype: IMAGE
    - Python dtype: torch.Tensor
- preset
    - Predefined parameters determine the structure and predefined text of the template. It simplifys the customization process by allowing users to select from the usual meme format.
    - Comfy dtype: COMBO['custom', 'One Does Not Simply ... MEME IN COMFY', 'This is fine.', 'Good Morning ... No Such Thing!']
    - Python dtype: str
- text_top
    - The text_top parameter allows the user to enter the text that will appear at the top of the image. It plays an important role in conveying the expected message or theme of the memes.
    - Comfy dtype: STRING
    - Python dtype: str
- text_bottom
    - Text_bottom parameters are used to display text at the bottom of the photo of the memes. It supplements the top text and helps with the overall structure of the memes.
    - Comfy dtype: STRING
    - Python dtype: str
- font_name
    - The font_name parameter allows the user to select a font style for text on the meme. The font selection significantly affects the readability and visual appeal of the meme, so it is an important custom option.
    - Comfy dtype: COMBO[file_list]
    - Python dtype: str
- max_font_size
    - The max_font_size parameter sets the maximum size for text fonts in the template. It is a key factor in determining the readability and visual balance of text in the layout of the mold.
    - Comfy dtype: INT
    - Python dtype: int
- font_color
    - The font_color parameter specifies the colour of the text in the template. It is a key aspect of the node function, as it affects the visibility of the text and the overall visual impact of the mold.
    - Comfy dtype: COMBO[COLORS]
    - Python dtype: str
- font_outline
    - The font_outline parameter adds a contour effect to the text, which enhances the visibility of the text on the photo background. The contour style selection can also add decorative features to the design of the memes.
    - Comfy dtype: COMBO['none', 'thin', 'thick', 'extra thick']
    - Python dtype: str
- bar_color
    - The colour of the decorative bars that may be added above and below the text in the template for bar_color parameter determination. This helps to attract attention to the text and provide a comparative background.
    - Comfy dtype: COMBO[COLORS]
    - Python dtype: str
- bar_options
    - Bar_options parameters determine whether to add decorative bars to the mold template and their location relative to the text. This affects the overall design of the mold and the emphasis on the text.
    - Comfy dtype: COMBO['no bars', 'top', 'bottom', 'top and bottom']
    - Python dtype: str

# Output types
- image
    - The picture output contains the ultimate molding template generated by the node. It represents all input parameters and customized results made by the user.
    - Comfy dtype: IMAGE
    - Python dtype: torch.Tensor
- show_help
    - Show_help output provides links to documents or help pages associated with nodes. This may be useful for users seeking additional guidance or information on how to use nodes.
    - Comfy dtype: STRING
    - Python dtype: str

# Usage tips
- Infra type: CPU

# Source code
```
class CR_SimpleMemeTemplate:

    @classmethod
    def INPUT_TYPES(s):
        font_dir = os.path.join(os.path.dirname(os.path.dirname(os.path.realpath(__file__))), 'fonts')
        file_list = [f for f in os.listdir(font_dir) if os.path.isfile(os.path.join(font_dir, f)) and f.lower().endswith('.ttf')]
        bar_opts = ['no bars', 'top', 'bottom', 'top and bottom']
        simple_meme_presets = ['custom', 'One Does Not Simply ... MEME IN COMFY', 'This is fine.', 'Good Morning ... No Such Thing!']
        return {'required': {'image': ('IMAGE',), 'preset': (simple_meme_presets,), 'text_top': ('STRING', {'multiline': True, 'default': 'text_top'}), 'text_bottom': ('STRING', {'multiline': True, 'default': 'text_bottom'}), 'font_name': (file_list,), 'max_font_size': ('INT', {'default': 150, 'min': 20, 'max': 2048}), 'font_color': (COLORS,), 'font_outline': (['none', 'thin', 'thick', 'extra thick'],), 'bar_color': (COLORS,), 'bar_options': (bar_opts,)}, 'optional': {'font_color_hex': ('STRING', {'multiline': False, 'default': '#000000'}), 'bar_color_hex': ('STRING', {'multiline': False, 'default': '#000000'})}}
    RETURN_TYPES = ('IMAGE', 'STRING')
    RETURN_NAMES = ('image', 'show_help')
    FUNCTION = 'make_meme'
    CATEGORY = icons.get('Comfyroll/Graphics/Template')

    def make_meme(self, image, preset, text_top, text_bottom, font_name, max_font_size, font_color, font_outline, bar_color, bar_options, font_color_hex='#000000', bar_color_hex='#000000'):
        text_color = get_color_values(font_color, font_color_hex, color_mapping)
        bar_color = get_color_values(bar_color, bar_color_hex, color_mapping)
        total_images = []
        for img in image:
            if bar_options == 'top':
                height_factor = 1.2
            elif bar_options == 'bottom':
                height_factor = 1.2
            elif bar_options == 'top and bottom':
                height_factor = 1.4
            else:
                height_factor = 1.0
            if preset == 'One Does Not Simply ... MEME IN COMFY':
                text_top = 'One Does Not Simply'
                text_bottom = 'MEME IN COMFY'
            if preset == 'This is fine.':
                text_top = 'This is fine.'
                text_bottom = ''
            if preset == 'Good Morning ... No Such Thing!':
                text_top = 'Good Morning'
                text_bottom = '"No Such Thing!"'
            back_image = tensor2pil(img)
            size = (back_image.width, int(back_image.height * height_factor))
            result_image = Image.new('RGB', size)
            font_file = os.path.join('fonts', font_name)
            resolved_font_path = os.path.join(os.path.dirname(os.path.dirname(os.path.realpath(__file__))), font_file)
            draw = ImageDraw.Draw(result_image)
            bar_width = back_image.width
            bar_height = back_image.height // 5
            top_bar = Image.new('RGB', (bar_width, bar_height), bar_color)
            bottom_bar = Image.new('RGB', (bar_width, bar_height), bar_color)
            if bar_options == 'top' or bar_options == 'top and bottom':
                image_out = result_image.paste(back_image, (0, bar_height))
            else:
                image_out = result_image.paste(back_image, (0, 0))
            if bar_options == 'top' or bar_options == 'top and bottom':
                result_image.paste(top_bar, (0, 0))
                font_top = get_font_size(draw, text_top, bar_width, bar_height, resolved_font_path, max_font_size)
                draw_text_on_image(draw, 0, bar_width, bar_height, text_top, font_top, text_color, font_outline)
            if bar_options == 'bottom' or bar_options == 'top and bottom':
                result_image.paste(bottom_bar, (0, result_image.height - bar_height))
                font_bottom = get_font_size(draw, text_bottom, bar_width, bar_height, resolved_font_path, max_font_size)
                if bar_options == 'bottom':
                    y_position = back_image.height
                else:
                    y_position = bar_height + back_image.height
                draw_text_on_image(draw, y_position, bar_width, bar_height, text_bottom, font_bottom, text_color, font_outline)
            if bar_options == 'bottom' and text_top > '':
                font_top = get_font_size(draw, text_top, bar_width, bar_height, resolved_font_path, max_font_size)
                draw_text_on_image(draw, 0, bar_width, bar_height, text_top, font_top, text_color, font_outline)
            if (bar_options == 'top' or bar_options == 'none') and text_bottom > '':
                font_bottom = get_font_size(draw, text_bottom, bar_width, bar_height, resolved_font_path, max_font_size)
                y_position = back_image.height
                draw_text_on_image(draw, y_position, bar_width, bar_height, text_bottom, font_bottom, text_color, font_outline)
            if bar_options == 'no bars' and text_bottom > '':
                font_bottom = get_font_size(draw, text_bottom, bar_width, bar_height, resolved_font_path, max_font_size)
                y_position = back_image.height - bar_height
                draw_text_on_image(draw, y_position, bar_width, bar_height, text_bottom, font_bottom, text_color, font_outline)
            if bar_options == 'no bars' and text_top > '':
                font_top = get_font_size(draw, text_top, bar_width, bar_height, resolved_font_path, max_font_size)
                draw_text_on_image(draw, 0, bar_width, bar_height, text_top, font_top, text_color, font_outline)
            out_image = np.array(result_image.convert('RGB')).astype(np.float32) / 255.0
            out_image = torch.from_numpy(out_image).unsqueeze(0)
            total_images.append(out_image)
        images_out = torch.cat(total_images, 0)
        show_help = 'https://github.com/Suzie1/ComfyUI_Comfyroll_CustomNodes/wiki/Template-Nodes#cr-simple-meme-template'
        return (images_out, show_help)
```