# Documentation
- Class name: IterativeMixingSamplerNode
- Category: sampling/custom_sampling/samplers
- Output node: False
- Repo Ref: https://github.com/ttulttul/ComfyUI-Iterative-Mixer

The node enhances the diversity and quality of the samples generated through an iterative mix of potential variables. It achieves fine control of the output generated by gradually adjusting the effects of different potential variables during the sampling process.

# Input types
## Required
- model
    - Model parameters are essential because it defines the generation network that the sampler will use. It determines the basic structure and learning outcomes that nodes will use to create new samples.
    - Comfy dtype: MODEL
    - Python dtype: comfy.model_management.Model
- sampler
    - Sampler parameters are essential for determining the sampling strategy. They affect the mix and interaction of potential variables, and thus the diversity and consistency of the samples generated.
    - Comfy dtype: COMBO
    - Python dtype: str
- alpha_1
    - Alpha_1 controls the initial impact of the main potential variables during the mixing process. Adjusting this parameter significantly changes the characteristics of the content generated to make it a key factor in achieving the desired result.
    - Comfy dtype: FLOAT
    - Python dtype: float
- blending_schedule
    - Mixed progress defines the progress of the hybrid process over time. It is essential to ensure a smooth transition between different potential impacts and to help generate the natural evolution of the sample.
    - Comfy dtype: COMBO
    - Python dtype: str
- blending_function
    - The function determines the combination of potential variables in the mixing process. It plays a key role in shaping the final characteristics that generate the samples, as it controls their overall composition.
    - Comfy dtype: COMBO
    - Python dtype: str
- normalize_on_mean
    - Enable this parameter to ensure that potential variables are normalized on the basis of their mean values. This contributes to a more balanced and predictable mix of processes and is essential for the consistency of outputs.
    - Comfy dtype: BOOLEAN
    - Python dtype: bool
- start_blending_at_pct
    - This parameter sets the starting point of the mixing process as a percentage of the total sampling step. It is important for adjusting the timing of the introduction of the mixture, which affects the overall quality and diversity of the sample.
    - Comfy dtype: FLOAT
    - Python dtype: float
- stop_blending_at_pct
    - Defines the stop point of the mixing process, and this parameter helps to control the duration of the mixing, thus affecting the final characteristic of the generation of the sample.
    - Comfy dtype: FLOAT
    - Python dtype: float
- clamp_blending_at_pct
    - This parameter limits the mixing effect to the specified percentage, ensures that the mixing does not override the underlying potential variables and maintains a balance in the generation process.
    - Comfy dtype: FLOAT
    - Python dtype: float
- blend_min
    - The blend_min parameter sets the minimum value of the mixture to ensure that the contribution of the potential variable mix is not too subtle and remains effective in shaping the output.
    - Comfy dtype: FLOAT
    - Python dtype: float
- blend_max
    - By setting a combined ceiling, blend_max ensures that the impact of the mixed potential variables does not exceed a certain threshold and maintains diversity without compromising the integrity of the underlying model.
    - Comfy dtype: FLOAT
    - Python dtype: float
- perlin_mode
    - Perlin_mode parameters introduce noise patterns in the mixing process, increasing randomity, which enhances creativity and variability in the generation of samples.
    - Comfy dtype: COMBO
    - Python dtype: str
- perlin_strength
    - Perlin strength determines the intensity of noise patterns and directly affects the extent of change in the mixing process, thus affecting the diversity of outputs.
    - Comfy dtype: FLOAT
    - Python dtype: float
- perlin_scale
    - The size of Perlin noise affects the particle size of the noise mode and, in turn, the fine detail and texture in which the samples are generated.
    - Comfy dtype: FLOAT
    - Python dtype: float
- rewind
    - When replaying is enabled, nodes can retrace previous steps in the sampling process, provide more control over the iterative mix and may result in more refined results.
    - Comfy dtype: BOOLEAN
    - Python dtype: bool
- rewind_min
    - The lower limit of the rewind_min is set to ensure that nodes do not retreat too far from the sampling steps, which could undermine the progress achieved.
    - Comfy dtype: FLOAT
    - Python dtype: float
- rewind_max
    - Rewind_max sets a ceiling on the return process to prevent excessive retroactivity that could lead to the loss of desired characteristics in the sample.
    - Comfy dtype: FLOAT
    - Python dtype: float

# Output types
- sampler
    - The output sampler is an example of a well-configured sampling strategy that combines parameters to produce diverse and high-quality samples, reflecting a fine mix of potential variables.
    - Comfy dtype: SAMPLER
    - Python dtype: comfy.samplers.KSampler

# Usage tips
- Infra type: GPU

# Source code
```
class IterativeMixingSamplerNode:
    """
    A sampler implementing iterative mixing of latents.
    Use this with the SamplerCustom node.
    """
    PERLIN_MODES = ['masks', 'latents', 'matched_noise']

    @classmethod
    def INPUT_TYPES(s):
        return {'required': {'model': ('MODEL',), 'sampler': (list(SAMPLERS_MAP.keys()), {'default': 'euler'}), 'alpha_1': ('FLOAT', {'default': 2.4, 'min': 0.05, 'max': 100.0, 'step': 0.05}), 'blending_schedule': (list(BLENDING_SCHEDULE_MAP.keys()), {'default': 'cosine'}), 'blending_function': (list(BLENDING_FUNCTION_MAP.keys()), {'default': 'addition'}), 'normalize_on_mean': ('BOOLEAN', {'default': False}), 'start_blending_at_pct': ('FLOAT', {'default': 0.0, 'min': 0.0, 'step': 0.01}), 'stop_blending_at_pct': ('FLOAT', {'default': 1.0, 'min': 0.0, 'step': 0.01}), 'clamp_blending_at_pct': ('FLOAT', {'default': 1.0, 'min': 0.0, 'max': 1.0, 'step': 0.01}), 'blend_min': ('FLOAT', {'default': 0.0, 'step': 0.01}), 'blend_max': ('FLOAT', {'default': 1.0, 'step': 0.01}), 'perlin_mode': (s.PERLIN_MODES, {'default': 'masks'}), 'perlin_strength': ('FLOAT', {'default': 0.75, 'step': 0.001}), 'perlin_scale': ('FLOAT', {'default': 10.0, 'min': 0.1, 'max': 400.0}), 'rewind': ('BOOLEAN', {'default': False}), 'rewind_min': ('FLOAT', {'default': 0.5, 'min': 0.0, 'max': 0.99}), 'rewind_max': ('FLOAT', {'default': 0.8, 'min': 0.01, 'max': 0.99})}}
    RETURN_TYPES = ('SAMPLER',)
    CATEGORY = 'sampling/custom_sampling/samplers'
    FUNCTION = 'get_sampler'

    def set_steps(self, steps, denoise=None):
        self.steps = steps
        if denoise is None or denoise > 0.9999:
            self.sigmas = self.calculate_sigmas(steps).to(self.device)
        else:
            new_steps = int(steps / denoise)
            sigmas = self.calculate_sigmas(new_steps).to(self.device)
            self.sigmas = sigmas[-(steps + 1):]

    def get_sampler(self, model, sampler, alpha_1, blending_schedule, blending_function, normalize_on_mean, start_blending_at_pct, stop_blending_at_pct, clamp_blending_at_pct, blend_min, blend_max, perlin_mode, perlin_strength, perlin_scale, rewind, rewind_min, rewind_max):
        extras = {k: v for (k, v) in locals().items() if k != 'self'}
        extras['model_node'] = extras['model']
        del extras['model']
        if sampler not in SAMPLERS_MAP:
            raise ValueError(f'invalid sampler: {sampler}')
        sampler_obj = SAMPLERS_MAP[sampler]()
        sampler_fn = functools.partial(sampler_obj.__call__)
        del extras['sampler']
        sampler = comfy.samplers.KSAMPLER(sampler_fn, extra_options=extras)
        return (sampler,)
```